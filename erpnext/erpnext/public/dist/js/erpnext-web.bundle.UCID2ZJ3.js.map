{
  "version": 3,
  "sources": ["../../../../../apps/erpnext/erpnext/public/js/website_utils.js", "../../../../../apps/erpnext/erpnext/public/js/shopping_cart.js"],
  "sourcesContent": ["// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\nif(!window.erpnext) window.erpnext = {};\n\n// Add / update a new Lead / Communication\n// subject, sender, description\nfrappe.send_message = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"erpnext.templates.utils.send_message\",\n\t\tbtn: btn,\n\t\targs: opts,\n\t\tcallback: opts.callback\n\t});\n};\n\nerpnext.subscribe_to_newsletter = function(opts, btn) {\n\treturn frappe.call({\n\t\ttype: \"POST\",\n\t\tmethod: \"frappe.email.doctype.newsletter.newsletter.subscribe\",\n\t\tbtn: btn,\n\t\targs: {\"email\": opts.email},\n\t\tcallback: opts.callback\n\t});\n}\n\n// for backward compatibility\nerpnext.send_message = frappe.send_message;\n", "// Copyright (c) 2015, Frappe Technologies Pvt. Ltd. and Contributors\n// License: GNU General Public License v3. See license.txt\n\n// shopping cart\nfrappe.provide(\"erpnext.shopping_cart\");\nvar shopping_cart = erpnext.shopping_cart;\n\nvar getParams = function (url) {\n\tvar params = [];\n\tvar parser = document.createElement('a');\n\tparser.href = url;\n\tvar query = parser.search.substring(1);\n\tvar vars = query.split('&');\n\tfor (var i = 0; i < vars.length; i++) {\n\t\tvar pair = vars[i].split('=');\n\t\tparams[pair[0]] = decodeURIComponent(pair[1]);\n\t}\n\treturn params;\n};\n\nfrappe.ready(function() {\n\tvar full_name = frappe.session && frappe.session.user_fullname;\n\t// update user\n\tif(full_name) {\n\t\t$('.navbar li[data-label=\"User\"] a')\n\t\t\t.html('<i class=\"fa fa-fixed-width fa fa-user\"></i> ' + full_name);\n\t}\n\t// set coupon code and sales partner code\n\n\tvar url_args = getParams(window.location.href);\n\n\tvar referral_coupon_code = url_args['cc'];\n\tvar referral_sales_partner = url_args['sp'];\n\n\tvar d = new Date();\n\t// expires within 30 minutes\n\td.setTime(d.getTime() + (0.02 * 24 * 60 * 60 * 1000));\n\tvar expires = \"expires=\"+d.toUTCString();\n\tif (referral_coupon_code) {\n\t\tdocument.cookie = \"referral_coupon_code=\" + referral_coupon_code + \";\" + expires + \";path=/\";\n\t}\n\tif (referral_sales_partner) {\n\t\tdocument.cookie = \"referral_sales_partner=\" + referral_sales_partner + \";\" + expires + \";path=/\";\n\t}\n\treferral_coupon_code=frappe.get_cookie(\"referral_coupon_code\");\n\treferral_sales_partner=frappe.get_cookie(\"referral_sales_partner\");\n\n\tif (referral_coupon_code && $(\".tot_quotation_discount\").val()==undefined ) {\n\t\t$(\".txtcoupon\").val(referral_coupon_code);\n\t}\n\tif (referral_sales_partner) {\n\t\t$(\".txtreferral_sales_partner\").val(referral_sales_partner);\n\t}\n\t// update login\n\tshopping_cart.show_shoppingcart_dropdown();\n\tshopping_cart.set_cart_count();\n\tshopping_cart.bind_dropdown_cart_buttons();\n\tshopping_cart.show_cart_navbar();\n});\n\n$.extend(shopping_cart, {\n\tshow_shoppingcart_dropdown: function() {\n\t\t$(\".shopping-cart\").on('shown.bs.dropdown', function() {\n\t\t\tif (!$('.shopping-cart-menu .cart-container').length) {\n\t\t\t\treturn frappe.call({\n\t\t\t\t\tmethod: 'erpnext.shopping_cart.cart.get_shopping_cart_menu',\n\t\t\t\t\tcallback: function(r) {\n\t\t\t\t\t\tif (r.message) {\n\t\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\n\tupdate_cart: function(opts) {\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tif(localStorage) {\n\t\t\t\tlocalStorage.setItem(\"last_visited\", window.location.pathname);\n\t\t\t}\n\t\t\twindow.location.href = \"/login\";\n\t\t} else {\n\t\t\treturn frappe.call({\n\t\t\t\ttype: \"POST\",\n\t\t\t\tmethod: \"erpnext.shopping_cart.cart.update_cart\",\n\t\t\t\targs: {\n\t\t\t\t\titem_code: opts.item_code,\n\t\t\t\t\tqty: opts.qty,\n\t\t\t\t\tadditional_notes: opts.additional_notes !== undefined ? opts.additional_notes : undefined,\n\t\t\t\t\twith_items: opts.with_items || 0\n\t\t\t\t},\n\t\t\t\tbtn: opts.btn,\n\t\t\t\tcallback: function(r) {\n\t\t\t\t\tshopping_cart.set_cart_count();\n\t\t\t\t\tif (r.message.shopping_cart_menu) {\n\t\t\t\t\t\t$('.shopping-cart-menu').html(r.message.shopping_cart_menu);\n\t\t\t\t\t}\n\t\t\t\t\tif(opts.callback)\n\t\t\t\t\t\topts.callback(r);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\n\tset_cart_count: function() {\n\t\tvar cart_count = frappe.get_cookie(\"cart_count\");\n\t\tif(frappe.session.user===\"Guest\") {\n\t\t\tcart_count = 0;\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$(\".shopping-cart\").toggleClass('hidden', false);\n\t\t}\n\n\t\tvar $cart = $('.cart-icon');\n\t\tvar $badge = $cart.find(\"#cart-count\");\n\n\t\tif(parseInt(cart_count) === 0 || cart_count === undefined) {\n\t\t\t$cart.css(\"display\", \"none\");\n\t\t\t$(\".cart-items\").html('Cart is Empty');\n\t\t\t$(\".cart-tax-items\").hide();\n\t\t\t$(\".btn-place-order\").hide();\n\t\t\t$(\".cart-addresses\").hide();\n\t\t}\n\t\telse {\n\t\t\t$cart.css(\"display\", \"inline\");\n\t\t}\n\n\t\tif(cart_count) {\n\t\t\t$badge.html(cart_count);\n\t\t} else {\n\t\t\t$badge.remove();\n\t\t}\n\t},\n\n\tshopping_cart_update: function({item_code, qty, cart_dropdown, additional_notes}) {\n\t\tfrappe.freeze();\n\t\tshopping_cart.update_cart({\n\t\t\titem_code,\n\t\t\tqty,\n\t\t\tadditional_notes,\n\t\t\twith_items: 1,\n\t\t\tbtn: this,\n\t\t\tcallback: function(r) {\n\t\t\t\tfrappe.unfreeze();\n\t\t\t\tif(!r.exc) {\n\t\t\t\t\t$(\".cart-items\").html(r.message.items);\n\t\t\t\t\t$(\".cart-tax-items\").html(r.message.taxes);\n\t\t\t\t\tif (cart_dropdown != true) {\n\t\t\t\t\t\t$(\".cart-icon\").hide();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t});\n\t},\n\n\n\tbind_dropdown_cart_buttons: function () {\n\t\t$(\".cart-icon\").on('click', '.number-spinner button', function () {\n\t\t\tvar btn = $(this),\n\t\t\t\tinput = btn.closest('.number-spinner').find('input'),\n\t\t\t\toldValue = input.val().trim(),\n\t\t\t\tnewVal = 0;\n\n\t\t\tif (btn.attr('data-dir') == 'up') {\n\t\t\t\tnewVal = parseInt(oldValue) + 1;\n\t\t\t} else {\n\t\t\t\tif (oldValue > 1) {\n\t\t\t\t\tnewVal = parseInt(oldValue) - 1;\n\t\t\t\t}\n\t\t\t}\n\t\t\tinput.val(newVal);\n\t\t\tvar item_code = input.attr(\"data-item-code\");\n\t\t\tshopping_cart.shopping_cart_update({item_code, qty: newVal, cart_dropdown: true});\n\t\t\treturn false;\n\t\t});\n\n\t},\n\n\tshow_cart_navbar: function () {\n\t\tfrappe.call({\n\t\t\tmethod: \"erpnext.shopping_cart.doctype.shopping_cart_settings.shopping_cart_settings.is_cart_enabled\",\n\t\t\tcallback: function(r) {\n\t\t\t\t$(\".shopping-cart\").toggleClass('hidden', r.message ? false : true);\n\t\t\t}\n\t\t});\n\t}\n});\n"],
  "mappings": "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",
  "names": []
}
